<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>小电拼充电站监控</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🔌</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="cable-config.js"></script>
    <script src="cable-manager.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="header-left-group">
                    <h1 class="title">⚡ 小电拼充电站监控</h1>
                    <div class="gateway-selector" id="gatewaySelector">
                        <select id="gatewaySelect" class="gateway-select">
                            <option value="">正在扫描网关...</option>
                        </select>
                    </div>
                    <div class="header-layout-toggle" id="headerLayoutToggle">
                        <div class="toggle-slider"></div>
                        <div class="toggle-labels">
                            <span class="toggle-label active" id="standardLabel">标准</span>
                            <span class="toggle-label" id="compactLabel">简洁</span>
                        </div>
                    </div>
                </div>
                <div class="header-right" style="display: flex; align-items: center; gap: 16px;">
                    <button class="settings-btn" id="settingsBtn" title="设备控制">⚙️</button>
                    <div class="status-indicator">
                        <div class="status-dot" id="statusDot"></div>
                        <span id="statusText">连接中...</span>
                    </div>
                </div>
            </div>
        </header>

        <div class="main-layout">
            <div class="left-column">
                <div class="cluster-card">
                    <div class="cluster-header">
                        <h3>🌐 充电网络监控</h3>
                        <span class="cluster-badge" id="onlineGatewayCount">0/0 在线</span>
                    </div>
                    <div class="cluster-overview">
                        <div class="cluster-big-stat">
                            <span class="label">全网总功率</span>
                            <span class="value" id="globalTotalPower">0.0</span>
                            <span class="unit">W</span>
                        </div>
                        <div class="cluster-big-stat">
                            <span class="label">接入设备</span>
                            <span class="value" id="globalActiveDevices">0</span>
                            <span class="unit">个</span>
                        </div>
                    </div>
                    <div class="gateway-matrix" id="gatewayMatrix"></div>
                </div>

                <div class="metrics-header">
                    <h3>📍 当前节点详情</h3>
                </div>
                <div class="metrics-row">
                    <div class="metric-card power-card">
                        <div class="metric-icon">⚡</div>
                        <div class="metric-content">
                            <h3>总功率</h3>
                            <div class="metric-value" id="powerValue">-- W</div>
                            <div class="metric-change" id="powerChange">--</div>
                            <div class="power-load-bar-container" style="margin-top: 8px;">
                                <div class="power-load-bar" id="powerLoadBar"></div>
                            </div>
                            <div class="metric-change" id="powerLoadText" style="margin-top: 2px; font-size: 10px; opacity: 0.6;">负载 0%</div>
                        </div>
                    </div>
                    <div class="metric-card voltage-card">
                        <div class="metric-icon">🔋</div>
                        <div class="metric-content">
                            <h3>电压</h3>
                            <div class="metric-value" id="voltageValue2">-- V</div>
                            <div class="metric-change" id="voltageChange2">--</div>
                        </div>
                    </div>
                    <div class="metric-card current-card">
                        <div class="metric-icon">⚡</div>
                        <div class="metric-content">
                            <h3>电流</h3>
                            <div class="metric-value" id="currentValue2">-- A</div>
                            <div class="metric-change" id="currentChange2">--</div>
                        </div>
                    </div>
                    <div class="metric-card wifi-card">
                        <div class="metric-icon">📶</div>
                        <div class="metric-content">
                            <h3>蓝牙信号</h3>
                            <div class="metric-value" id="wifiValue">-- dBm</div>
                            <div class="metric-change" id="wifiChange">--</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-section">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>功率趋势</h3>
                            <div class="chart-controls">
                                <div class="chart-mode-buttons">
                                    <button class="chart-mode-btn active" id="realtimeToggle">实时</button>
                                    <button class="chart-mode-btn" id="tenMinuteToggle">10分钟</button>
                                    <button class="chart-mode-btn" id="hourlyToggle">1小时</button>
                                </div>
                                <button class="wake-lock-btn" id="wakeLockToggle">
                                    <span class="wake-icon">🌙</span>
                                    <span class="wake-text">常亮</span>
                                </button>
                            </div>
                        </div>
                        <canvas id="powerChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="middle-column">
                <div class="reallyvison-card">
                    <div class="reallyvison-header">
                        <h3>3D充电站可视化</h3>
                        <div class="toggle-buttons">
                            <div id="rotationToggle" class="rotation-toggle" title="切换方向">
                                <span class="toggle-text">竖屏</span>
                            </div>
                            <div id="layoutToggle" class="layout-toggle" title="切换简洁模式">
                                <span class="toggle-text">简洁</span>
                            </div>
                        </div>
                    </div>
                    <div class="reallyvison" id="reallyvison">
                        <div class="particle-system" id="particleSystem">
                            <div class="breathing-glow"></div>
                            <div class="energy-ripple"></div>
                            <div class="energy-ripple"></div>
                            <div class="energy-ripple"></div>
                        </div>
                        
                        <img src="putong.png" alt="普通线材" class="cable-putong cable-port-0" style="display: none;" />
                        <img src="putong.png" alt="普通线材" class="cable-putong cable-port-1" style="display: none;" />
                        <img src="putong.png" alt="普通线材" class="cable-putong cable-port-2" style="display: none;" />
                        
                        <img src="xili.png" alt="细雳线材" class="cable-xili cable-port-0" style="display: none;" />
                        <img src="xili.png" alt="细雳线材" class="cable-xili cable-port-1" style="display: none;" />
                        <img src="xili.png" alt="细雳线材" class="cable-xili cable-port-2" style="display: none;" />
                        
                        <img src="xili2.png" alt="细雳线材2" class="cable-xili2 cable-port-0" style="display: none;" />
                        <img src="xili2.png" alt="细雳线材2" class="cable-xili2 cable-port-1" style="display: none;" />
                        <img src="xili2.png" alt="细雳线材2" class="cable-xili2 cable-port-2" style="display: none;" />
                        
                        <img src="yunduo.png" alt="云朵线材" class="cable-yunduo cable-port-0" style="display: none;" />
                        <img src="yunduo.png" alt="云朵线材" class="cable-yunduo cable-port-1" style="display: none;" />
                        <img src="yunduo.png" alt="云朵线材" class="cable-yunduo cable-port-2" style="display: none;" />
                        
                        <img src="okokok.png" alt="ok线材" class="cable-okokok cable-port-0" style="display: none;" />
                        <img src="okokok.png" alt="ok线材" class="cable-okokok cable-port-1" style="display: none;" />
                        <img src="okokok.png" alt="ok线材" class="cable-okokok cable-port-2" style="display: none;" />
                        
                        <img src="meizup.png" alt="魅族卷卷线" class="cable-meizu cable-port-0" style="display: none;" />
                        <img src="meizup.png" alt="魅族卷卷线" class="cable-meizu cable-port-1" style="display: none;" />
                        <img src="meizup.png" alt="魅族卷卷线" class="cable-meizu cable-port-2" style="display: none;" />
                        
                        <img src="pingguox.png" alt="苹果官方线" class="cable-apple cable-port-0" style="display: none;" />
                        <img src="pingguox.png" alt="苹果官方线" class="cable-apple cable-port-1" style="display: none;" />
                        <img src="pingguox.png" alt="苹果官方线" class="cable-apple cable-port-2" style="display: none;" />
                        
                        <img src="kutaike.png" alt="酷态科线" class="cable-kutaike cable-port-0" style="display: none;" />
                        <img src="kutaike.png" alt="酷态科线" class="cable-kutaike cable-port-1" style="display: none;" />
                        <img src="kutaike.png" alt="酷态科线" class="cable-kutaike cable-port-2" style="display: none;" />
                        
                        <img src="huaxian.png" alt="花线" class="cable-huaxian cable-port-0" style="display: none;" />
                        <img src="huaxian.png" alt="花线" class="cable-huaxian cable-port-1" style="display: none;" />
                        <img src="huaxian.png" alt="花线" class="cable-huaxian cable-port-2" style="display: none;" />
                        
                        <img src="landput.png" alt="端口4普通线" class="cable-land-putong cable-port-3" style="display: none;" />
                        <img src="landyunduo.png" alt="端口4云朵线" class="cable-land-yunduo cable-port-3" style="display: none;" />
                        <img src="landxili2.png" alt="端口4犀利线" class="cable-land-xili2 cable-port-3" style="display: none;" />
                        <img src="landokokok.png" alt="端口4ok线" class="cable-land-okokok cable-port-3" style="display: none;" />
                        <img src="meizup.png" alt="端口4魅族卷卷线" class="cable-land-meizu cable-port-3" style="display: none;" />
                        <img src="landpingguo.png" alt="端口4苹果官方线" class="cable-land-apple cable-port-3" style="display: none;" />
                        <img src="landkutaik.png" alt="端口4酷态科线" class="cable-land-kutaike cable-port-3" style="display: none;" />
                        <img src="landhuaxian.png" alt="端口4花线" class="cable-land-huaxian cable-port-3" style="display: none;" />
                        
                        <img src="000usb.png" alt="USB设备" class="cable-usb cable-port-usb" style="display: none;" />
                        
                        <div class="charging-indicator charging-port-0" id="charging-indicator-0"></div>
                        <div class="charging-indicator charging-port-1" id="charging-indicator-1"></div>
                        <div class="charging-indicator charging-port-2" id="charging-indicator-2"></div>
                        <div class="charging-indicator charging-port-3" id="charging-indicator-3"></div>
                        <div class="charging-indicator charging-port-4" id="charging-indicator-4"></div>
                        
                        <div class="power-info power-info-0" id="power-info-0" style="display: none;"></div>
                        <div class="power-info power-info-1" id="power-info-1" style="display: none;"></div>
                        <div class="power-info power-info-2" id="power-info-2" style="display: none;"></div>
                        <div class="power-info power-info-3" id="power-info-3" style="display: none;"></div>
                        <div class="power-info power-info-4" id="power-info-4" style="display: none;"></div>
                    </div>
                    
                    <div class="compact-metrics" id="compactMetrics" style="display: none;">
                        <div class="compact-metric">
                            <span class="compact-label">功率</span>
                            <span class="compact-value" id="compactPower">-- W</span>
                        </div>
                        <div class="compact-metric">
                            <span class="compact-label">电压</span>
                            <span class="compact-value" id="compactVoltage">-- V</span>
                        </div>
                        <div class="compact-metric">
                            <span class="compact-label">电流</span>
                            <span class="compact-value" id="compactCurrent">-- A</span>
                        </div>
                        <div class="compact-metric">
                            <span class="compact-label">蓝牙</span>
                            <span class="compact-value" id="compactWifi">-- dBm</span>
                        </div>
                    </div>
                </div>

                <div class="status-section">
                    <div class="status-card">
                        <h3>充电桩状态</h3>
                        <div class="status-grid">
                            <div class="status-item">
                                <div class="status-icon">🔋</div>
                                <div class="status-content">
                                    <span class="status-label">总电压</span>
                                    <span class="status-value" id="voltageValue">-- V</span>
                                </div>
                            </div>
                            <div class="status-item">
                                <div class="status-icon">⚡</div>
                                <div class="status-content">
                                    <span class="status-label">总电流</span>
                                    <span class="status-value" id="currentValue">-- A</span>
                                </div>
                            </div>
                            <div class="status-item">
                                <div class="status-icon">📶</div>
                                <div class="status-content">
                                    <span class="status-label">蓝牙信号</span>
                                    <span class="status-value" id="temperatureValue">-- dBm</span>
                                </div>
                            </div>
                            <div class="status-item">
                                <div class="status-icon">🏃</div>
                                <div class="status-content">
                                    <span class="status-label">充电状态</span>
                                    <span class="status-value" id="chargingStatus">待机</span>
                                </div>
                            </div>
                            <div class="status-item">
                                <div class="status-icon">🔌</div>
                                <div class="status-content">
                                    <span class="status-label">活跃端口</span>
                                    <span class="status-value" id="totalTime">0 个</span>
                                </div>
                            </div>
                            <div class="status-item">
                                <div class="status-icon">💾</div>
                                <div class="status-content">
                                    <span class="status-label">系统内存</span>
                                    <span class="status-value" id="totalEnergy">0 KB</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="ports-section">
                    <div class="ports-header">
                        <h3>端口详情</h3>
                        <button class="refresh-btn" id="refreshBtn">
                            <span class="refresh-icon">🔄</span>
                            刷新
                        </button>
                    </div>
                    <div class="ports-container" id="portsContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="controlModal">
        <div class="control-panel">
            <div class="panel-header">
                <div class="panel-title-wrapper">
                    <div class="panel-icon">⚙️</div>
                    <h2>设备控制中心</h2>
                </div>
                <button class="close-btn" id="closeModal">✕</button>
            </div>
            <div class="panel-content">
                <div class="control-group modern-group">
                    <div class="group-header-modern">
                        <div class="header-left">
                            <span class="group-icon">📡</span>
                            <h3>蓝牙连接</h3>
                        </div>
                        <div class="header-right-status">
                            <span class="status-badge" id="bleConnectionStatus">未连接</span>
                        </div>
                    </div>
                    
                    <div class="connection-card">
                        <div class="conn-info">
                            <span class="conn-label">网关</span>
                            <span class="conn-value" id="currentGatewayName">--</span>
                        </div>
                        <div class="conn-arrow">➔</div>
                        <div class="conn-info">
                            <span class="conn-label">充电站</span>
                            <span class="conn-value" id="targetDeviceName">未连接</span>
                        </div>
                    </div>

                    <div class="scan-section">
                        <div class="device-list-container-modern">
                            <ul class="device-list" id="deviceList">
                                <li class="device-item empty">
                                    <span class="empty-icon">📶</span>
                                    <span class="empty-text">点击扫描搜索附近设备</span>
                                </li>
                            </ul>
                            <div class="radar-overlay" id="radarOverlay" style="display: none;">
                                <div class="radar-spinner"></div>
                                <div class="radar-text">扫描中...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-grid" style="margin-top: 12px;">
                        <button class="action-btn" id="scanBtn">🔍 扫描设备</button>
                        <button class="action-btn btn-warning" id="disconnectBtn">🔌 断开连接</button>
                    </div>
                </div>

                <div class="control-group modern-group">
                    <div class="group-header-modern">
                        <div class="header-left">
                            <span class="group-icon">🔑</span>
                            <h3>Token 管理</h3>
                        </div>
                    </div>
                    <div class="button-grid-modern">
                        <button class="modern-btn btn-warning-modern" id="bruteforceBtn">
                            <span class="btn-icon-large">🔓</span>
                            <span class="btn-text-large">自动破解</span>
                            <span class="btn-hint">0x00-0xFF</span>
                        </button>
                        <button class="modern-btn btn-secondary-modern" id="reconnectBtn">
                            <span class="btn-icon-large">🔄</span>
                            <span class="btn-text-large">重新连接</span>
                            <span class="btn-hint">刷新状态</span>
                        </button>
                    </div>
                    <div class="token-input-wrapper">
                        <div class="input-with-label">
                            <label class="input-label">
                                <span class="label-icon">🎯</span>
                                <span class="label-text">手动设置Token</span>
                            </label>
                            <div class="input-group-modern">
                                <input type="text" class="modern-input" id="tokenInput" placeholder="如: 128 或 0x80">
                                <button class="save-btn-modern" id="saveTokenBtn">
                                    <span class="btn-icon">💾</span>
                                    <span>保存</span>
                                </button>
                            </div>
                            <div class="input-hint">支持十进制 (0-255) 或十六进制 (0x00-0xFF)</div>
                        </div>
                    </div>
                </div>

                <div class="control-group modern-group">
                    <div class="group-header-modern">
                        <div class="header-left">
                            <span class="group-icon">🔌</span>
                            <h3>端口开关</h3>
                        </div>
                        <button class="scan-btn-modern" style="padding: 4px 10px; font-size: 11px;" onclick="monitor.updateControlPanelStatus()">
                            <span class="btn-icon">🔄</span>
                            <span class="btn-text">刷新</span>
                        </button>
                    </div>
                    <div class="port-switches modern-switches" id="portSwitches"></div>
                </div>

                <div class="control-group collapsible">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('active')">
                        <h3>📱 设备信息</h3>
                        <span class="toggle-icon">▼</span>
                    </div>
                    <div class="group-content">
                        <div class="info-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                            <div class="info-item">
                                <span class="label">型号</span>
                                <span class="value" id="infoModel">--</span>
                            </div>
                            <div class="info-item">
                                <span class="label">序列号</span>
                                <span class="value" id="infoSerial">--</span>
                            </div>
                            <div class="info-item">
                                <span class="label">固件</span>
                                <span class="value" id="infoFirmware">--</span>
                            </div>
                            <div class="info-item">
                                <span class="label">BLE地址</span>
                                <span class="value" id="infoBleAddr">--</span>
                            </div>
                            <div class="info-item">
                                <span class="label">运行时间</span>
                                <span class="value" id="infoUptime">--</span>
                            </div>
                        </div>
                        <div class="action-grid">
                            <button class="action-btn" id="refreshInfoBtn">🔄 刷新</button>
                            <button class="action-btn btn-danger" id="rebootBtn">🔄 重启</button>
                            <button class="action-btn btn-danger" onclick="if(confirm('确定恢复出厂设置?')) monitor.sendAction('factory_reset')">⚠️ 出厂</button>
                        </div>
                    </div>
                </div>

                <div class="control-group collapsible">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('active')">
                        <h3>📶 WiFi 网络管理</h3>
                        <span class="toggle-icon">▼</span>
                    </div>
                    <div class="group-content">
                        <div class="wifi-status-card" style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                            <div class="status-row" style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="label">WiFi 状态</span>
                                <span class="value" id="wifiStatusValue" style="color: #aaa;">--</span>
                            </div>
                        </div>
                        <div class="action-grid" style="margin-bottom: 12px;">
                            <button class="action-btn" onclick="monitor.getWifiStatus()">📡 查询状态</button>
                            <button class="action-btn" onclick="monitor.scanWifi()">🔍 扫描热点</button>
                        </div>
                        <div id="wifiScanResults" style="max-height: 120px; overflow-y: auto; margin-bottom: 12px;"></div>
                        <div class="input-with-label" style="margin-bottom: 8px;">
                            <label class="input-label">SSID</label>
                            <input type="text" class="modern-input" id="wifiSSID" placeholder="输入 WiFi 名称">
                        </div>
                        <div class="input-with-label" style="margin-bottom: 12px;">
                            <label class="input-label">密码</label>
                            <input type="password" class="modern-input" id="wifiPass" placeholder="输入 WiFi 密码">
                        </div>
                        <button class="action-btn btn-primary" style="width: 100%;" onclick="monitor.setWifi()">🔗 连接 WiFi</button>
                    </div>
                </div>

                <div class="control-group collapsible">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('active')">
                        <h3>📺 显示设置</h3>
                        <span class="toggle-icon">▼</span>
                    </div>
                    <div class="group-content">
                        <div class="slider-row">
                            <label>亮度</label>
                            <input type="range" min="0" max="100" value="50" class="brightness-slider" id="brightnessSlider" onchange="monitor.sendAction('set_brightness', {brightness: parseInt(this.value)})">
                        </div>
                        <div class="input-with-label" style="margin: 12px 0;">
                            <label class="input-label">显示模式</label>
                            <select class="modern-input" id="displayModeSelect" onchange="monitor.setDisplayMode(parseInt(this.value))">
                                <option value="0">默认模式</option>
                                <option value="1">简洁模式</option>
                                <option value="2">详细模式</option>
                                <option value="3">自定义模式</option>
                            </select>
                        </div>
                        <div class="action-grid">
                            <button class="action-btn" onclick="monitor.sendAction('flip_display')">🔄 翻转屏幕</button>
                            <button class="action-btn" onclick="monitor.getDisplaySettings()">📋 查询配置</button>
                        </div>
                    </div>
                </div>

                <div class="control-group collapsible">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('active')">
                        <h3>⚡ 充电策略</h3>
                        <span class="toggle-icon">▼</span>
                    </div>
                    <div class="group-content">
                        <div class="strategy-toggle-container">
                            <span class="strategy-toggle-label">功率分配</span>
                            <div class="toggle-wrapper" style="display: flex; align-items: center; gap: 8px;">
                                <span class="toggle-state-text" id="powerModeText" style="font-size: 10px; color: #aaa;">自动</span>
                                <label class="strategy-toggle">
                                    <input type="checkbox" id="powerModeToggle" onchange="monitor.sendAction('set_power_mode', {mode: this.checked ? 1 : 0})">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="strategy-toggle-container">
                            <span class="strategy-toggle-label">温控优先</span>
                            <div class="toggle-wrapper" style="display: flex; align-items: center; gap: 8px;">
                                <span class="toggle-state-text" style="font-size: 10px; color: #aaa;">关闭</span>
                                <label class="strategy-toggle">
                                    <input type="checkbox" id="tempModeToggle" onchange="monitor.sendAction('set_temp_mode', {enabled: this.checked})">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-group collapsible">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('active')">
                        <h3>🔌 端口高级配置</h3>
                        <span class="toggle-icon">▼</span>
                    </div>
                    <div class="group-content">
                        <div class="input-with-label" style="margin-bottom: 12px;">
                            <label class="input-label">选择端口</label>
                            <select class="modern-input" id="configPortId">
                                <option value="0">端口 1</option>
                                <option value="1">端口 2</option>
                                <option value="2">端口 3</option>
                                <option value="3">端口 4</option>
                                <option value="4">端口 5 (USB-A)</option>
                            </select>
                        </div>
                        <div class="port-config-info" id="portConfigInfo" style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
                                <div><span style="color: #888;">协议:</span> <span id="portConfigProtocol">--</span></div>
                                <div><span style="color: #888;">优先级:</span> <span id="portConfigPriority">--</span></div>
                            </div>
                        </div>
                        <div class="action-grid">
                            <button class="action-btn" onclick="monitor.getPortConfig()">📋 读取配置</button>
                            <button class="action-btn btn-primary" onclick="monitor.setPortConfig()">💾 保存配置</button>
                        </div>
                    </div>
                </div>

                <div class="control-group collapsible">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('active')">
                        <h3>🎯 端口优先级</h3>
                        <span class="toggle-icon">▼</span>
                    </div>
                    <div class="group-content">
                        <div class="port-priority-list">
                            <div class="input-with-label" style="margin-bottom: 8px;">
                                <label class="input-label">端口 1</label>
                                <div class="input-group-modern">
                                    <input type="number" class="modern-input" id="p1_priority" min="0" max="255" placeholder="0-255">
                                    <button class="save-btn-modern" onclick="monitor.setPortPriority(0)">设置</button>
                                </div>
                            </div>
                            <div class="input-with-label" style="margin-bottom: 8px;">
                                <label class="input-label">端口 2</label>
                                <div class="input-group-modern">
                                    <input type="number" class="modern-input" id="p2_priority" min="0" max="255" placeholder="0-255">
                                    <button class="save-btn-modern" onclick="monitor.setPortPriority(1)">设置</button>
                                </div>
                            </div>
                            <div class="input-with-label" style="margin-bottom: 8px;">
                                <label class="input-label">端口 3</label>
                                <div class="input-group-modern">
                                    <input type="number" class="modern-input" id="p3_priority" min="0" max="255" placeholder="0-255">
                                    <button class="save-btn-modern" onclick="monitor.setPortPriority(2)">设置</button>
                                </div>
                            </div>
                            <div class="input-with-label" style="margin-bottom: 8px;">
                                <label class="input-label">端口 4</label>
                                <div class="input-group-modern">
                                    <input type="number" class="modern-input" id="p4_priority" min="0" max="255" placeholder="0-255">
                                    <button class="save-btn-modern" onclick="monitor.setPortPriority(3)">设置</button>
                                </div>
                            </div>
                            <div class="input-with-label">
                                <label class="input-label">端口 5</label>
                                <div class="input-group-modern">
                                    <input type="number" class="modern-input" id="p5_priority" min="0" max="255" placeholder="0-255">
                                    <button class="save-btn-modern" onclick="monitor.setPortPriority(4)">设置</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-group collapsible">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('active')">
                        <h3>🛠️ 高级调试</h3>
                        <span class="toggle-icon">▼</span>
                    </div>
                    <div class="group-content">
                        <div class="debug-info-card" id="debugInfoCard" style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 12px; margin-bottom: 12px; font-family: monospace; font-size: 11px; max-height: 150px; overflow-y: auto; display: none;">
                            <pre id="debugInfoContent" style="margin: 0; white-space: pre-wrap; color: #0f0;"></pre>
                        </div>
                        
                        <div class="input-with-label" style="margin-bottom: 12px;">
                            <label class="input-label">选择端口 (PD状态/温度)</label>
                            <select class="modern-input" id="debugPortId">
                                <option value="0">端口 1</option>
                                <option value="1">端口 2</option>
                                <option value="2">端口 3</option>
                                <option value="3">端口 4</option>
                                <option value="4">端口 5 (USB-A)</option>
                            </select>
                        </div>
                        
                        <div class="action-grid" style="grid-template-columns: repeat(3, 1fr);">
                            <button class="action-btn" onclick="monitor.getPortPdStatus()">⚡ PD状态</button>
                            <button class="action-btn" onclick="monitor.getPortTemperature()">🌡️ 温度</button>
                            <button class="action-btn" onclick="monitor.getPowerCurve()">📈 功率曲线</button>
                        </div>
                        <div class="action-grid" style="margin-top: 8px;">
                            <button class="action-btn" onclick="monitor.bleEchoTest()">🔊 回显测试</button>
                            <button class="action-btn" onclick="monitor.getDebugLog()">📝 获取日志</button>
                        </div>
                    </div>
                </div>

                <div class="control-group collapsible">
                    <div class="group-header" onclick="this.parentElement.classList.toggle('active')">
                        <h3>⚙️ 系统设置</h3>
                        <span class="toggle-icon">▼</span>
                    </div>
                    <div class="group-content">
                        <div class="input-with-label" style="margin-bottom: 12px;">
                            <label class="input-label">API Key (可选)</label>
                            <div class="input-group-modern">
                                <input type="password" class="modern-input" id="apiKeyInput" placeholder="留空则无需认证">
                            </div>
                        </div>
                        
                        <div class="ota-section">
                            <label class="input-label" style="margin-bottom: 8px; display: block;">固件更新</label>
                            <div class="file-upload-wrapper">
                                <input type="file" id="firmwareFile" accept=".bin" class="file-input">
                                <button class="action-btn btn-primary" id="uploadFirmwareBtn">OTA 更新</button>
                            </div>
                            <div class="progress-container" style="display: none;" id="uploadProgressContainer">
                                <div class="progress-bar" id="uploadProgressBar" style="width: 0%"></div>
                            </div>
                            <div class="status-message" id="otaStatusMessage"></div>
                        </div>
                        
                        <button class="action-btn btn-danger" style="width: 100%; margin-top: 12px;" onclick="monitor.resetWifi()">重置 WiFi 设置</button>
                    </div>
                </div>

                <div class="control-group">
                    <h3>📡 网关列表</h3>
                    <div class="gateway-list" id="gatewayList"></div>
                </div>

                <div class="control-group">
                    <h3>📝 操作日志</h3>
                    <div class="status-log" id="actionLog">
                        <div class="log-entry">准备就绪...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
